<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteio Cell Azul</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #003399; color: white; text-align: center; padding: 20px; }
        .card { background: white; color: #333; padding: 25px; border-radius: 20px; }
        input { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 18px; background: #28a745; color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; }
        .lgpd { font-size: 12px; color: #666; margin: 15px 0; text-align: left; }
    </style>
</head>
<body>
    <div id="box" class="card">
        <h2>üéÅ Cell Azul</h2>
        <input type="text" id="nome" placeholder="Nome e Sobrenome">
        <input type="tel" id="zap" placeholder="(00) 00000-0000" maxlength="15">
        <div class="lgpd">
            <input type="checkbox" id="check"> Aceito os termos da LGPD e autorizo o contato.
        </div>
        <button onclick="jogar()">TENTAR A SORTE üçÄ</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        // M√°scara Din√¢mica
        document.getElementById('zap').addEventListener('input', e => {
            let x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,5})(\d{0,4})/);
            e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
        });

        function jogar() {
            const n = document.getElementById('nome').value.trim();
            const z = document.getElementById('zap').value;
            const c = document.getElementById('check').checked;

            if (n.split(' ').length < 2) return alert("Digite nome e sobrenome!");
            if (z.length < 14) return alert("WhatsApp inv√°lido!");
            if (!c) return alert("Aceite a LGPD!");

            socket.emit('resgatar_oferta', { cliente: { nome: n, zap: z } });
        }

        socket.on('sucesso', d => {
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            navigator.vibrate ? navigator.vibrate(200) : null;
            
            document.getElementById('box').innerHTML = `
                <h1 style="color:#28a745">üéâ GANHOU!</h1>
                <p>Seu pr√™mio: <strong>${d.produto}</strong></p>
                <a href="https://wa.me/55${document.getElementById('zap').value.replace(/\D/g,'')}?text=Meu Voucher: ${d.link}" 
                   style="display:block; padding:15px; background:#25D366; color:white; text-decoration:none; border-radius:10px; font-weight:bold;">
                   üì± SALVAR NO WHATSAPP
                </a>
            `;
        });
    </script>
</body>
</html>
