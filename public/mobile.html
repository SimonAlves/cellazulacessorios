<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteio Cell Azul</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #003399; color: white; margin: 0; padding: 20px; }
        .container { background: white; color: #333; padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); max-width: 400px; margin: auto; }
        h2 { color: #003399; margin-top: 0; }
        input[type="text"], input[type="tel"] { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #eee; border-radius: 12px; box-sizing: border-box; font-size: 16px; }
        .lgpd { font-size: 11px; color: #777; text-align: left; display: flex; align-items: flex-start; gap: 10px; margin: 15px 0; }
        button { width: 100%; padding: 18px; background: #28a745; color: white; border: none; border-radius: 12px; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #218838; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .ganhou { text-align: center; }
    </style>
</head>
<body>
    <div class="container" id="app">
        <h2>üéÅ Cell Azul</h2>
        <p>Preencha para participar do sorteio!</p>
        
        <input type="text" id="nome" placeholder="Nome Completo">
        <input type="tel" id="zap" placeholder="(00) 00000-0000" maxlength="15">
        
        <div class="lgpd">
            <input type="checkbox" id="check" style="margin-top: 3px;">
            <span>Autorizo o uso dos meus dados para fins promocionais conforme a LGPD.</span>
        </div>
        
        <button id="btnJogar" onclick="tentarSorte()">QUERO MEU PR√äMIO! üçÄ</button>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        // M√°scara de WhatsApp din√¢mica
        document.getElementById('zap').addEventListener('input', e => {
            let x = e.target.value.replace(/\D/g, '').match(/(\d{0,2})(\d{0,5})(\d{0,4})/);
            e.target.value = !x[2] ? x[1] : '(' + x[1] + ') ' + x[2] + (x[3] ? '-' + x[3] : '');
        });

        function tentarSorte() {
            const nomeInput = document.getElementById('nome');
            const zapInput = document.getElementById('zap');
            const check = document.getElementById('check');
            const btn = document.getElementById('btnJogar');

            const nome = nomeInput.value.trim();
            const zap = zapInput.value.replace(/\D/g, ''); // Apenas n√∫meros para valida√ß√£o
            const lgpd = check.checked;

            // Valida√ß√µes
            if (nome.split(' ').length < 2) return alert("Por favor, insira Nome e Sobrenome.");
            if (zap.length < 10) return alert("WhatsApp inv√°lido. Insira DDD + N√∫mero.");
            if (!lgpd) return alert("√â necess√°rio aceitar os termos da LGPD.");

            // Trava o bot√£o para evitar cliques duplos
            btn.disabled = true;
            btn.innerText = "SORTEANDO...";

            socket.emit('resgatar_oferta', { cliente: { nome, zap: zapInput.value } });
        }

        socket.on('sucesso', d => {
            // Efeito de Confetes
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            
            // Vibra√ß√£o do Celular (Padr√£o: vibrar, pausa, vibrar forte)
            if (navigator.vibrate) navigator.vibrate([100, 30, 300]);

            // Mensagem do Voucher e Link de WhatsApp
            const msgZap = window.encodeURIComponent(`üéâ Ol√°! Acabei de ganhar um pr√™mio na Cell Azul!\nüéÅ Pr√™mio: ${d.produto}\nüîó Veja o meu Voucher: ${d.link}`);
            const numLimpo = document.getElementById('zap').value.replace(/\D/g,'');

            document.getElementById('app').innerHTML = `
                <div class="ganhou">
                    <h1 style="color:#28a745">PARAB√âNS!</h1>
                    <p style="font-size:1.2rem">Voc√™ ganhou: <strong>${d.produto}</strong></p>
                    <p>Clique abaixo para salvar seu cupom no WhatsApp:</p>
                    <br>
                    <a href="https://wa.me/55${numLimpo}?text=${msgZap}" 
                       style="text-decoration:none; display:block; padding:20px; background:#25D366; color:white; border-radius:15px; font-weight:bold; font-size: 1.1rem;">
                       üì± SALVAR NO MEU WHATSAPP
                    </a>
                    <p style="color:#777; font-size:0.9rem; margin-top:15px;">Apresente o cupom no caixa para resgatar.</p>
                </div>
            `;
        });
    </script>
</body>
</html>
