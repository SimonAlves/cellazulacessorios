<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>TV CELL AZUL</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; display: flex; height: 100vh; overflow: hidden; }
        #promo { flex: 3; display: flex; align-items: center; justify-content: center; background: #111; }
        #sidebar { flex: 1; background: #003399; display: flex; flex-direction: column; align-items: center; justify-content: space-around; padding: 20px; border-left: 5px solid #FFD700; text-align: center; }
        .qr-area { background: #fff; padding: 15px; border-radius: 15px; width: 80%; }
        .qr-area img { width: 100%; display: block; }
        .contador { font-size: 5rem; color: #FFD700; font-weight: bold; }
        #vitoria-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; color: #FFD700; }
    </style>
</head>
<body>
    <div id="vitoria-overlay">
        <h1 style="font-size: 4rem;">ðŸŽ‰ GANHOU! ðŸŽ‰</h1>
        <h2 id="premio-nome" style="font-size: 3rem; color: #fff;">---</h2>
    </div>

    <div id="promo">
        <img id="banner" style="max-width: 90%; max-height: 90%;" src="">
    </div>

    <div id="sidebar">
        <h1 id="nome-loja">CELL AZUL</h1>
        <div class="qr-area">
            <img id="qrcode-img" src="/qrcode">
        </div>
        <p style="font-size: 1.2rem;">ESCANEIE PARA GANHAR</p>
        <div>
            <p>RESTAM APENAS:</p>
            <div id="qtd-num" class="contador">--</div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        socket.on('trocar_slide', (d) => {
            document.getElementById('banner').src = '/' + d.arquivo;
            document.getElementById('nome-loja').innerText = d.loja;
            document.getElementById('qtd-num').innerText = d.qtd;
            // ForÃ§a atualizaÃ§Ã£o do QR Code
            document.getElementById('qrcode-img').src = '/qrcode?v=' + Date.now();
        });

        socket.on('atualizar_qtd', (d) => {
            document.getElementById('qtd-num').innerText = d.qtd;
        });

        socket.on('aviso_vitoria_tv', (d) => {
            const overlay = document.getElementById('vitoria-overlay');
            document.getElementById('premio-nome').innerText = d.premio;
            overlay.style.display = 'flex';
            
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });

            setTimeout(() => { overlay.style.display = 'none'; }, 6000);
        });
    </script>
</body>
</html>
