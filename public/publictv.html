<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>TV CELL AZUL - MODO DINMICO</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* =======================================================================
        锔 AVISO DE CONFIGURAO DE TELA (ALTERE AQUI):
        
        SE A TV ESTIVER DEITADA (HORIZONTAL): Deixe o valor 'none' abaixo.
        SE A TV ESTIVER EM P (VERTICAL): Mude o valor para 'rotate(90deg)'.
        =======================================================================
        */
        :root {
            --ajuste-rotacao: none; 
        }

        body { 
            margin: 0; 
            background: #000; 
            color: #fff; 
            font-family: sans-serif; 
            height: 100vh; 
            width: 100vw;
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
            transform: var(--ajuste-rotacao); 
            transform-origin: center;
        }
        
        /* Layout Flexbox Responsivo */
        #main { flex: 1; display: flex; flex-direction: row; overflow: hidden; }
        
        /* Ajuste autom谩tico para telas verticais (Totens) */
        @media (max-width: 900px) {
            #main { flex-direction: column; }
            #side { width: 100% !important; border-left: none !important; border-top: 5px solid #FFD700; }
        }

        #promo { flex: 3; display: flex; align-items: center; justify-content: center; background: #111; }
        #banner-img { max-width: 95%; max-height: 95%; object-fit: contain; }

        #side { 
            flex: 1; 
            background: #003399; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: space-around; 
            padding: 20px; 
            border-left: 5px solid #FFD700; 
            text-align: center; 
        }
        
        .qr-area { background: #fff; padding: 10px; border-radius: 15px; width: 60%; max-width: 250px; }
        .qr-area img { width: 100%; display: block; }
        
        .counter { font-size: 6rem; color: #FFD700; font-weight: bold; }

        /* Rodap茅 de Patrocinadores */
        #footer-patrocinadores {
            height: 8vh;
            background: #111;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #FFD700;
            font-size: 1.5rem;
            border-top: 3px solid #FFD700;
            text-transform: uppercase;
            font-weight: bold;
        }

        /* Overlay de Ganhador */
        #win-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); display: none; flex-direction: column; 
            align-items: center; justify-content: center; z-index: 1000; color: #FFD700; 
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="win-overlay">
        <h1 style="font-size: 4rem;"> TEMOS UM GANHADOR!</h1>
        <h2 id="win-premio" style="font-size: 3rem; color: #fff;">---</h2>
        <p style="font-size: 1.5rem;">NA CELL AZUL ACESSRIOS</p>
    </div>

    <div id="main">
        <div id="promo"><img id="banner-img" src=""></div>
        
        <div id="side">
            <h1 style="margin:0;">CELL AZUL</h1>
            <div class="qr-area"><img id="qr-display" src="/qrcode"></div>
            <p style="font-weight: bold;">SORTEIO NO QR CODE</p>
            <div>
                <p style="margin:0;">RESTAM APENAS:</p>
                <div id="qtd-display" class="counter">--</div>
            </div>
        </div>
    </div>

    <div id="footer-patrocinadores">
        <div id="ticker">CARREGANDO PARCEIROS...</div>
    </div>

    <audio id="vitoria-som" src="vitoria.mp3"></audio>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const som = document.getElementById('vitoria-som');

        // L贸gica do Rodap茅 de Patrocinadores
        const parceiros = ["CELL AZUL", "CRIATIVO ZONE", "IMPACTU MDIA", "POLIPET"];
        let indexParceiro = 0;
        setInterval(() => {
            document.getElementById('ticker').innerText = parceiros[indexParceiro] + " - PROMOO ATIVA";
            indexParceiro = (indexParceiro + 1) % parceiros.length;
        }, 5000);

        // Recebe os dados iniciais do servidor
        socket.on('trocar_slide', (dados) => {
            // AJUSTE: Adicionado quebra-cache (?v=) para a imagem atualizar ap贸s o upload
            document.getElementById('banner-img').src = '/' + dados.arquivo + '?v=' + Date.now();
            document.getElementById('qtd-display').innerText = dados.qtd;
            
            // Atualiza o QR Code para garantir que n茫o fique em cache
            document.getElementById('qr-display').src = '/qrcode?v=' + Date.now();
        });

        // Atualiza a quantidade em tempo real
        socket.on('atualizar_qtd', (dados) => {
            // CORREO: Ajustado de 'd.qtd' para 'dados.qtd'
            document.getElementById('qtd-display').innerText = dados.qtd;
        });

        // Evento de Vit贸ria disparado pelo Socket
        socket.on('aviso_vitoria_tv', (dados) => {
            const overlay = document.getElementById('win-overlay');
            document.getElementById('win-premio').innerText = dados.premio;
            overlay.style.display = 'flex';
            
            // Toca som e solta confetes
            som.play().catch(() => console.log("Clique na TV para liberar o som"));
            confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } });

            setTimeout(() => { overlay.style.display = 'none'; }, 7000);
        });

        // Clique obrigat贸rio para habilitar o 谩udio no navegador da TV
        document.body.onclick = () => { som.play(); som.pause(); };
    </script>
</body>
</html>
