<!DOCTYPE html>
<html>
<head>
    <title>TV Cell Azul Acessórios</title>
</head>
<body style="margin:0; background:black; overflow:hidden; font-family: 'Arial', sans-serif;">
    <div style="display:flex; height:100vh;">
        <div style="flex:3; background:black; display:flex; align-items:center; justify-content:center; position:relative;">
            <div id="bgBlur" style="position:absolute; width:100%; height:100%; background-size:cover; background-position:center; filter:blur(20px) brightness(0.5); z-index:1;"></div>
            <img id="imgPrincipal" src="/cell azul capa.jpg" style="max-width:100%; max-height:100%; object-fit:contain; z-index:2; box-shadow: 0 0 50px rgba(0,0,0,0.5);">
        </div>

        <div id="sidebar" style="flex:1; background:#003399; display:flex; flex-direction:column; align-items:center; justify-content:center; border-left:5px solid #FFD700; text-align:center; color:white; z-index:10;">
            <div style="background:white; padding:10px; border-radius:15px; margin-bottom:20px;">
                <h2 style="color:#003399; margin:0; font-size:1.2rem;">CELL AZUL</h2>
            </div>
            
            <h1 id="nomeLoja" style="font-size:1.8rem; padding:0 10px; text-transform:uppercase;">CARREGANDO...</h1>
            <p style="font-size:1.1rem; color:#FFD700; font-weight:bold; margin-bottom:10px;">SORTEIO NO QR CODE</p>
            
            <div style="background:white; padding:10px; border-radius:10px;">
                <img id="qr" style="width:200px; display:block;">
            </div>
            
            <p style="margin-top:10px; font-weight:bold; letter-spacing:1px;">APONTE A CÂMERA</p>
            
            <div style="margin-top:20px; border-top:2px dashed rgba(255,255,255,0.3); width:80%; padding-top:20px;">
                <p style="margin:0; font-size:0.9rem;">RESTAM APENAS:</p>
                <h2 id="num" style="font-size:5rem; color:#FFD700; margin:0; line-height:1;">--</h2>
            </div>
        </div>
    </div>
    
    <div id="fim" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); color:white; align-items:center; justify-content:center; flex-direction:column; z-index:99; text-align:center;">
        <h1 style="font-size:4rem; color:#FFD700;">PROMOÇÃO ENCERRADA!</h1>
        <p style="font-size:1.8rem;">Aguarde o próximo sorteio da Cell Azul.</p>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        // Atualiza o QR Code apontando para a rota de geração
        document.getElementById('qr').src = '/qrcode';
        
        // Escuta a troca de slides (campanhas) do servidor
        socket.on('trocar_slide', (d) => {
            if(!d || !d.loja) return;

            document.getElementById('nomeLoja').innerText = d.loja;
            document.getElementById('num').innerText = d.qtd;
            document.getElementById('imgPrincipal').src = '/' + d.arquivo;
            document.getElementById('bgBlur').style.backgroundImage = "url('/" + d.arquivo + "')";
            document.getElementById('sidebar').style.backgroundColor = d.cor || '#003399';

            const fimDiv = document.getElementById('fim');
            if(d.qtd <= 0) {
                fimDiv.style.display = 'flex';
            } else {
                fimDiv.style.display = 'none';
            }
        });

        // Atualiza apenas a quantidade em tempo real quando alguém ganha
        socket.on('atualizar_qtd', (d) => {
            document.getElementById('num').innerText = d.qtd;
        });
    </script>
</body>
</html>
